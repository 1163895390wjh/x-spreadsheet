!function(t){var e={};function i(s){if(e[s])return e[s].exports;var l=e[s]={i:s,l:!1,exports:{}};return t[s].call(l.exports,l,l.exports,i),l.l=!0,l.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var l in t)i.d(s,l,function(e){return t[e]}.bind(null,l));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t,e,i){},function(t,e,i){"use strict";i.r(e);const s=(t={},...e)=>(e.forEach(e=>{Object.keys(e).forEach(i=>{const l=e[i];"string"==typeof l||"number"==typeof l||"boolean"==typeof l?t[i]=l:"function"!=typeof l&&!Array.isArray(l)&&l instanceof Object?(t[i]=t[i]||{},s(t[i],l)):t[i]=l})}),t);var l={cloneDeep:function(t){return JSON.parse(JSON.stringify(t))},merge:(...t)=>s({},...t),equals:function t(e,i){const s=Object.keys(e);if(s.length!==Object.keys(i).length)return!1;for(let l=0;l<s.length;l+=1){const h=s[l],o=e[h],n=i[h];if(void 0===n)return!1;if("string"==typeof o||"number"==typeof o||"boolean"==typeof o){if(o!==n)return!1}else if(Array.isArray(o)){if(o.length!==n.length)return!1;for(let e=0;e<o.length;e+=1)if(!t(o[e],n[e]))return!1}else if("function"!=typeof o&&!Array.isArray(o)&&o instanceof Object&&!t(o,n))return!1}return!0},sum:(t,e=(t=>t))=>{let i=0,s=0;return Object.keys(t).forEach(l=>{i+=e(t[l],l),s+=1}),[i,s]},rangeEach:function(t,e,i){for(let s=t;s<e;s+=1)i(s)},rangeSum:function(t,e,i){let s=0;for(let l=t;l<e;l+=1)s+=i(l);return s},rangeReduceIf:function(t,e,i,s,l,h){let o=i,n=s,r=t;for(;r<e&&!(o>l);r+=1)o+=n=h(r);return[r,o-n,n]},deleteProperty:function(t,e){const i=t[`${e}`];return delete t[`${e}`],i}};class h{constructor(t,e=""){"string"==typeof t?(this.el=document.createElement(t),this.el.className=e):this.el=t,this.data={}}data(t,e){return void 0!==e?(this.data[t]=e,this):this.data[t]}on(t,e){const[i,...s]=t.split(".");let l=i;return"mousewheel"===l&&/Firefox/i.test(window.navigator.userAgent)&&(l="DOMMouseScroll"),this.el.addEventListener(l,t=>{e(t);for(let e=0;e<s.length;e+=1){const i=s[e];if("left"===i&&0!==t.button)return;if("right"===i&&2!==t.button)return;"stop"===i&&t.stopPropagation()}}),this}offset(t){if(void 0!==t)return Object.keys(t).forEach(e=>{this.css(e,`${t[e]}px`)}),this;const{offsetTop:e,offsetLeft:i,offsetHeight:s,offsetWidth:l}=this.el;return{top:e,left:i,height:s,width:l}}scroll(t){const{el:e}=this;return void 0!==t&&(void 0!==t.left&&(e.scrollLeft=t.left),void 0!==t.top&&(e.scrollTop=t.top)),{left:e.scrollLeft,top:e.scrollTop}}box(){return this.el.getBoundingClientRect()}parent(){return new h(this.el.parentNode)}children(...t){return 0===arguments.length?this.el.childNodes:(t.forEach(t=>this.child(t)),this)}child(t){let e=t;return"string"==typeof t?e=document.createTextNode(t):t instanceof h&&(e=t.el),this.el.appendChild(e),this}contains(t){return this.el.contains(t)}className(t){return void 0!==t?(this.el.className=t,this):this.el.className}addClass(t){return this.el.classList.add(t),this}hasClass(t){return this.el.classList.contains(t)}removeClass(t){return this.el.classList.remove(t),this}toggle(t="active"){return this.toggleClass(t)}toggleClass(t){return this.el.classList.toggle(t)}active(t=!0){return t?this.addClass("active"):this.removeClass("active"),this}disabled(t=!0){return t?this.addClass("disabled"):this.removeClass("disabled"),this}attr(t,e){if(void 0!==e)this.el.setAttribute(t,e);else{if("string"==typeof t)return this.el.getAttribute(t);Object.keys(t).forEach(e=>{this.el.setAttribute(e,t[e])})}return this}removeAttr(t){return this.el.removeAttribute(t),this}html(t){return void 0!==t?(this.el.innerHTML=t,this):this.el.innerHTML}val(t){return void 0!==t?(this.el.value=t,this):this.el.value}cssRemoveKeys(...t){return t.forEach(t=>this.el.style.removeProperty(t)),this}css(t,e){return void 0===e&&"string"!=typeof t?(Object.keys(t).forEach(e=>{this.el.style[e]=t[e]}),this):void 0!==e?(this.el.style[t]=e,this):this.el.style[t]}computedStyle(){return window.getComputedStyle(this.el,null)}show(){return this.css("display","block"),this}hide(){return this.css("display","none"),this}}const o=(t,e="")=>new h(t,e),n=[{key:"SUM",title:"求和",render:t=>t.reduce((t,e)=>Number(t)+Number(e),0)},{key:"AVERAGE",title:"求平均值",render:t=>t.reduce((t,e)=>Number(t)+Number(e),0)/t.length},{key:"MAX",title:"最大值",render:t=>Math.max(...t.map(t=>Number(t)))},{key:"MIN",title:"最小值",render:t=>Math.min(...t.map(t=>Number(t)))},{key:"CONCAT",title:"字符串拼接",render:t=>t.join("")}],r=(t=[])=>{const e={};return n.concat(t).forEach(t=>{e[t.key]=t}),e},c=t=>t,a=t=>{if(/^(-?\d*.?\d*)$/.test(t)){const e=Number(t).toFixed(2).toString(),[i,...s]=e.split("\\.");return[i.replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"),...s]}return t},d=[{key:"normal",title:"Normal",type:"string",render:c},{key:"text",title:"Plain Text",type:"string",render:c},{key:"number",title:"Number",type:"number",label:"1,000.12",render:a},{key:"percent",title:"Percent",type:"number",label:"10.12%",render:t=>`${t}%`},{key:"rmb",title:"RMB",type:"number",label:"￥10.00",render:t=>`￥${a(t)}`},{key:"usd",title:"USD",type:"number",label:"$10.00",render:t=>`$${a(t)}`},{key:"date",title:"Date",type:"date",label:"26/09/2008",render:c},{key:"time",title:"Time",type:"date",label:"15:59:00",render:c},{key:"datetime",title:"Date time",type:"date",label:"26/09/2008 15:59:00",render:c},{key:"duration",title:"Duration",type:"date",label:"24:01:00",render:c}],f=(t=[])=>{const e={};return d.concat(t).forEach(t=>{e[t.key]=t}),e},u=[{key:"Helvetica",title:"Helvetica"},{key:"Source Sans Pro",title:"Source Sans Pro"},{key:"Comic Sans MS",title:"Comic Sans MS"},{key:"Arial",title:"Arial"},{key:"Courier New",title:"Courier New"},{key:"Verdana",title:"Verdana"}],g=[{pt:7.5,px:10},{pt:8,px:11},{pt:9,px:12},{pt:10,px:13},{pt:10.5,px:14},{pt:11,px:15},{pt:12,px:16},{pt:14,px:18.7},{pt:15,px:20},{pt:16,px:21.3},{pt:18,px:24},{pt:22,px:29.3},{pt:24,px:32},{pt:26,px:34.7},{pt:36,px:48},{pt:42,px:56}];const p=(t=[])=>{const e={};return u.concat(t).forEach(t=>{e[t.key]=t}),e},m=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];var b={stringAt:t=>{let e="",i=t;for(;i>=m.length;)i/=m.length,i-=1,e+=m[parseInt(i,10)%m.length];return e+=m[t%m.length]},indexAt:t=>{let e=0;for(let i=0;i<t.length-1;i+=1){const s=t.charCodeAt(i)-65,l=t.length-1-i;e+=m.length**l+m.length*s}return e+=t.charCodeAt(t.length-1)-65}};const w=t=>{let e="",i="";for(let s=0;s<t.length;s+=1)t.charAt(s)>="0"&&t.charAt(s)<="9"?i+=t.charAt(s):e+=t.charAt(s);return[b.indexAt(e),parseInt(i,10)]},x=(t,e,i)=>{const[s,l]=w(t);return b.stringAt(s+e)+(l+i)},v=(t,e)=>{if(t[0]>="0"&&t[0]<="9")return Number(t);if('"'===t[0])return t.substring(1);const[i,s]=w(t);return e(i,s)},y=(t,e,i,s,l)=>{if("="===i[0]){const h=(t=>{const e=[],i=[];let s=[],l=0,h=1;for(let o=0;o<t.length;o+=1){const n=t.charAt(o);if(" "!==n)if(n>="a"&&n<="z")s.push(n.toUpperCase());else if(n>="0"&&n<="9"||n>="A"&&n<="Z"||"."===n)s.push(n);else if('"'===n){for(o+=1;'"'!==t.charAt(o);)s.push(t.charAt(o)),o+=1;i.push(`"${s.join("")}`),s=[]}else{if(s.length>0&&i.push(s.join("")),")"===n){let t=e.pop();if(2===l){const[e,s]=w(i.pop()),[l,h]=w(i.pop());let o=0;for(let t=l;t<=e;t+=1)for(let e=h;e<=s;e+=1)i.push(b.stringAt(t)+e),o+=1;i.push([t,o])}else if(1===l)i.push([t,h]),h=1;else for(;"("!==t&&e.length>0;)i.push(t),t=e.pop();l=0}else if(":"===n)l=2;else if(","===n)l=1,h+=1;else if("("===n&&s.length>0)i.pop(),e.push(s.join(""));else{if(e.length>0&&("+"===n||"-"===n)){const t=e[e.length-1];if("*"===t||"/"===t)for(;e.length>0;)i.push(e.pop())}e.push(n)}s=[]}}for(s.length>0&&i.push(s.join(""));e.length>0;)i.push(e.pop());return i})(i.substring(1));return h.length<=0?i:((t,e,i)=>{const s=[];for(let l=0;l<t.length;l+=1)if("+"===t[l]){const t=s.pop(),e=s.pop();s.push(Number(e)+Number(t))}else if("-"===t[l]){const t=s.pop();s.push(Number(s.pop())-Number(t))}else if("*"===t[l])s.push(Number(s.pop())*Number(s.pop()));else if("/"===t[l]){const t=s.pop();s.push(Number(s.pop())/Number(t))}else if(Array.isArray(t[l])){const[i,h]=t[l],o=[];for(let t=0;t<h;t+=1)o.push(s.pop());s.push(e[i].render(o))}else s.push(v(t[l],i));return s[0]})(h,s,(i,h)=>{const o=t===h-1&&e===i?0:l(i,h-1);return y(t,e,o,s,l)})}return i};var k={render:y};const C={freeze:[0,0],merges:[],rowm:{},colm:{},cellmm:{},styles:[]};class I{constructor(){this.undoItems=[],this.redoItems=[]}add(t){this.undoItems.push(l.cloneDeep(t)),this.redoItems=[]}canUndo(){return this.undoItems.length>0}canRedo(){return this.redoItems.length>0}undo(t,e){const{undoItems:i,redoItems:s}=this;this.canUndo()&&(s.push(l.cloneDeep(t)),e(i.pop()))}redo(t,e){const{undoItems:i,redoItems:s}=this;this.canRedo()&&(i.push(l.cloneDeep(t)),e(s.pop()))}}class E{constructor(){this.sIndexes=null,this.eIndexes=null,this.state="clear"}copy(t,e){return this.set(t,e,"copy"),this}cut(t,e){return this.set(t,e,"cut"),this}isCopy(){return"copy"===this.state}isCut(){return"cut"===this.state}set(t,e,i){return this.sIndexes=t,this.eIndexes=e,this.state=i,this}get(){return[this.sIndexes,this.eIndexes]}isClear(){return"clear"===this.state}clear(){this.sIndexes=null,this.sIndexes=null,this.state="clear"}}class ${constructor(){this.indexes=[0,0],this.sIndexes=[-1,-1],this.eIndexes=[-1,-1]}getRange(){return[this.sIndexes,this.eIndexes]}setRange(t,e){this.sIndexes=t,this.eIndexes=e}seqe(){const[t,e]=this.sIndexes,[i,s]=this.eIndexes;return t===i&&e===s}each(t){const[e,i]=this.sIndexes,[s,l]=this.eIndexes;for(let h=e;h<=s;h+=1)for(let e=i;e<=l;e+=1)t(h,e)}}class S{constructor(){this.x=0,this.y=0,this.indexes=[0,0]}}function R(){this.history.add(this.d)}function T([t,e],[i,s],l="all"){const{d:h}=this,{cellmm:o}=h;for(let h=t;h<=i;h+=1)for(let t=e;t<=s;t+=1){const e=this.getCell(h,t);e&&("all"===l?delete o[h][`${t}`]:"text"===l?e.text&&delete e.text:"format"===l&&(void 0!==e.si&&delete e.si,e.merge&&delete e.merge))}}function z(t){const{merges:e}=this.d;if(e.length>0)for(let i=0;i<e.length;i+=1)t(e[i])}function O(t,e,i,s){if(t.length>0)for(let l=0;l<t.length;l+=1){const[[h,o],[n,r]]=t[l];if(e>=h&&e<=n&&i>=o&&i<=r){s(t[l]);break}}}function A([t,e],[i,s]){const l=[];z.call(this,h=>{const[[o,n],[r,c]]=h;(o>i||t>r||n>s||e>c)&&l.push(h)}),this.d.merges=l}function W(t,e){A.call(this,t,e),this.d.merges.push([t,e])}function F(t,e){const i=this.getCell(t,e);if(i&&i.merge){const[s,l]=i.merge;if(s<=0&&l<=0)return;W.call(this,[t,e],[t+s,e+l])}}function H(t,e,i){const s="row"===t?0:1;z.call(this,t=>{const[l,h]=t;if(l[s]>=e)l[s]+=i,h[s]+=i;else if(l[s]<e&&e<=h[s]){h[s]+=i,this.getCell(...l).merge[s]+=i}})}function D(t,e,i,s=!1){const{cellmm:h}=this.d,[[o,n],[r,c]]=t,[[a,d],[f,u]]=e,g=r-o+1,p=c-n+1;let m=!0,b=0;(f<o||u<n)&&(m=!1,b=f<o?f-a+1:u-d+1),"all"!==i&&"format"!==i||(T.call(this,[a,d],[f,u],i),A.call(this,[a,d],[f,u]));for(let t=o;t<=r;t+=1)if(h[t])for(let e=n;e<=c;e+=1)if(h[t][e])for(let r=a;r<=f;r+=g)for(let c=d;c<=u;c+=p){const f=r+(t-o),u=c+(e-n),g=l.cloneDeep(h[t][e]);if(s&&g&&g.text&&g.text.length>0){const{text:t}=g;let e=c-d+(r-a)+1;if(m||(e-=b+1),"="===t[0])g.text=t.replace(/\w{1,3}\d/g,t=>{let[i,s]=[0,0];return o===a?i=e:s=e,x(t,i,s)});else{const i=/[\\.\d]+$/.exec(t);if(null!==i){const s=Number(i[0])+e;g.text=t.substring(0,i.index)+s}}}this.setCell(f,u,g,i),F.call(this,f,u)}}function L(t,e){const{clipboard:i,d:s}=this,{cellmm:l}=s,[[h,o],[n,r]]=t,[[c,a]]=e,d={};Object.keys(l).forEach(t=>{Object.keys(l[t]).forEach(e=>{let i=parseInt(t,10),s=parseInt(e,10);t>=h&&t<=n&&e>=o&&e<=r&&(i=c+(i-h),s=a+(s-o)),d[i]=d[i]||{},d[i][s]=l[t][e]})}),function([t,e],[i,s],l,h){z.call(this,o=>{const[[n,r],[c,a]]=o;if(n>i||t>c||r>s||e>a);else for(let t=0;t<=1;t+=1){const e=o[t];e[0]+=l,e[1]+=h}})}.call(this,[h,o],[n,r],c-h,a-o),s.cellmm=d,i.clear()}function N(t,e,i){const{styles:s}=this.d,h=this.getCellOrNew(t,e);let o={};void 0!==h.si&&(o=l.cloneDeep(s[h.si])),Object.assign(o,i),h.si=this.addStyle(o)}function M(t,e){const[i,s,l,h]=e,o=[];for(let e=0;e<t.length;e+=1){const[[n,r],[c,a]]=t[e];n>l||i>c||r>h||s>a||o.push(t[e])}return o}class j{constructor(t){this.options=t,this.formulam=r(t.formulas),this.formatm=f(t.formats),this.fontm=p(t.fonts),this.d=C,this.clipboard=new E,this.history=new I,this.scroll=new S,this.selector=new $,this.change=(()=>{})}getView(){return this.options.view}load(t){this.d=l.merge(C,t)}canUndo(){return this.history.canUndo()}canRedo(){return this.history.canRedo()}undo(){const{history:t}=this;t.undo(this.d,t=>{this.d=t})}redo(){const{history:t}=this;t.redo(this.d,t=>{this.d=t})}isMultiple(){const[[t,e],[i,s]]=this.selector.getRange();if(t===i&&e===s)return!1;const l=this.getCell(t,e);if(l&&l.merge){const[h,o]=l.merge;if(t+h===i&&e+o===s)return!1}return!0}setSelectedIndexes(t,e){this.selector.setRange(t,e)}setSelectedCurrentIndexes(t){this.selector.indexes=t}xyInSelectedRect(t,e){const{left:i,top:s,width:l,height:h}=this.getSelectedRect(),{row:o,col:n}=this.options,r=t-n.indexWidth,c=e-o.height;return r>i&&r<i+l&&c>s&&c<s+h}getSelectedCellStyle(){return this.getCellStyle(...this.selector.indexes)}getSelectedCellOrNew(){return this.getCellOrNew(...this.selector.indexes)}getSelectedCell(){return this.getCell(...this.selector.indexes)}setSelectedCellText(t){this.setCellText(...this.selector.indexes,t)}getSelectedRect(){return this.getRect(...this.selector.getRange())}setSelectedCellAttr(t,e){R.call(this);const{selector:i}=this,{styles:s}=this.d;if("merge"===t)e?this.merge():this.unmerge();else if("border"===t)(function({mode:t,style:e,color:i}){const{styles:s}=this.d,[[h,o],[n,r]]=this.selector.getRange(),c=this.isMultiple();if(c||"inside"!==t&&"horizontal"!==t&&"vertical"!==t)if("outside"!==t||c){if("none"===t)for(let t=h;t<=n;t+=1)for(let e=o;e<=r;e+=1){const i=this.getCell(t,e);if(i&&void 0!==i.si){const t=l.cloneDeep(s[i.si]);["bb","bt","bl","br"].forEach(e=>{t[e]&&delete t[e]}),i.si=this.addStyle(t)}}else if("all"===t||"inside"===t||"outside"===t||"horizontal"===t||"vertical"===t){const s=[];for(let l=h;l<=n;l+=1)for(let a=o;a<=r;a+=1){const d=[];for(let t=0;t<s.length;t+=1){const[e,i,h,o]=s[t];if(l===e+h+1&&d.push(t),e<=l&&l<=e+h&&a===i){a+=o+1;break}}if(d.forEach(t=>s.splice(t,1)),a>r)break;const f=this.getCell(l,a);let[u,g]=[0,0];f&&f.merge&&([u,g]=f.merge,s.push([l,a,u,g]));const p=u>0&&l+u===n,m=g>0&&a+g===r;let b={};"all"===t?b={bb:[e,i],br:[e,i],bl:[e,i],bt:[e,i]}:"inside"===t?(!m&&a<r&&(b.br=[e,i]),!p&&l<n&&(b.bb=[e,i])):"horizontal"===t?!p&&l<n&&(b.bb=[e,i]):"vertical"===t?!m&&a<r&&(b.br=[e,i]):"outside"===t&&c&&(h===l&&(b.bt=[e,i]),(p||n===l)&&(b.bb=[e,i]),o===a&&(b.bl=[e,i]),(m||r===a)&&(b.br=[e,i])),Object.keys(b).length>0&&N.call(this,l,a,b),a+=g}}else if("top"===t||"bottom"===t)for(let s=o;s<=r;s+=1)"top"===t&&(N.call(this,h,s,{bt:[e,i]}),s+=this.getCellMerge(h,s)[1]),"bottom"===t&&(N.call(this,n,s,{bb:[e,i]}),s+=this.getCellMerge(n,s)[1]);else if("left"===t||"right"===t)for(let s=h;s<=n;s+=1)"left"===t&&(N.call(this,s,o,{bl:[e,i]}),s+=this.getCellMerge(s,o)[0]),"right"===t&&(N.call(this,s,r,{br:[e,i]}),s+=this.getCellMerge(s,r)[0])}else N.call(this,h,o,{bt:[e,i],bb:[e,i],bl:[e,i],br:[e,i]})}).call(this,e);else if("formula"===t){this.getCellOrNew(...i.indexes).text=`=${e}()`}else i.each((i,h)=>{const o=this.getCellOrNew(i,h);let n={};if(void 0!==o.si&&(n=l.cloneDeep(s[o.si])),"format"===t)o.format=e;else if("font-bold"===t||"font-italic"===t||"font-name"===t||"font-size"===t){const i={};i[t.split("-")[1]]=e,n.font=Object.assign(n.font||{},i),o.si=this.addStyle(n)}else"strikethrough"!==t&&"textwrap"!==t&&"underline"!==t&&"align"!==t&&"valign"!==t&&"color"!==t&&"bgcolor"!==t||(n[t]=e,o.si=this.addStyle(n))});this.change(this.d)}getClipboardRect(){const{clipboard:t}=this;if(!t.isClear()){const[e,i]=t.get();return this.getRect(e,i)}return{left:-100,top:-100}}getRect([t,e],[i,s]){const{scroll:l}=this;if(t<0&&e<0)return{left:0,l:0,top:0,t:0,scroll:l};const{left:h,top:o}=this.cellPosition(t,e),n=this.rowSumHeight(t,i+1),r=this.colSumWidth(e,s+1);let c=h-l.x,a=o-l.y;const d=this.freezeTotalHeight(),f=this.freezeTotalWidth();return f>0&&f>h&&(c=h),d>0&&d>o&&(a=o),{l:h,t:o,left:c,top:a,height:n,width:r,scroll:l}}getCellRectByXY(t,e){const{scroll:i,d:s}=this;let{ri:h,top:o,height:n}=function(t,e){const{options:i}=this,{row:s}=i,h=this.freezeTotalHeight();let o=s.height;h+s.height<t&&(o-=e);const[n,r,c]=l.rangeReduceIf(0,this.rowLen(),o,s.height,t,t=>this.getRowHeight(t));return r<=0?{ri:-1,top:0,height:c}:{ri:n-1,top:r,height:c}}.call(this,e,i.y),{ci:r,left:c,width:a}=function(t,e){const{options:i}=this,{col:s}=i,h=this.freezeTotalWidth();let o=s.indexWidth;h+s.indexWidth<t&&(o-=e);const[n,r,c]=l.rangeReduceIf(0,this.colLen(),o,s.indexWidth,t,t=>this.getColWidth(t));return r<=0?{ci:-1,left:0,width:s.indexWidth}:{ci:n-1,left:r,width:c}}.call(this,t,i.x);return-1===r&&(a=this.colTotalWidth()),-1===h&&(n=this.rowTotalHeight()),(h>=0||r>=0)&&O(s.merges,h,r,([[t,e]])=>{h=t,r=e,({left:c,top:o,width:a,height:n}=this.cellRect(t,e))}),{ri:h,ci:r,left:c,top:o,width:a,height:n}}calRangeIndexes2(t,e){const{indexes:i,sIndexes:s,eIndexes:l}=this.selector,[h,o]=i;let[n,r]=s,[c,a]=l,[d,f]=[t,e];return t<0&&(d=this.rowLen()-1),e<0&&(f=this.colLen()-1),d<=h?[n,c]=[d,h]:c=d,f<=o?[r,a]=[f,o]:a=f,z.call(this,([[t,e],[i,s]])=>{t>c||n>i||e>a||r>s||(t<n&&(n=t),e<r&&(r=e),i>c&&(c=i),s>a&&(a=s))}),this.setSelectedIndexes([n,r],[c,a]),this.selector.getRange()}calRangeIndexes(t,e){const i=[t,e],s=[t,e];-1===t&&(i[0]=0,s[0]=this.rowLen()-1),-1===e&&(i[1]=0,s[1]=this.colLen()-1);let l=[i,s];return O(this.d.merges,t,e,t=>{l=t}),this.setSelectedIndexes(...l),l}copy(){const{sIndexes:t,eIndexes:e}=this.selector;this.clipboard.copy(t,e)}cut(){const{sIndexes:t,eIndexes:e}=this.selector;this.clipboard.cut(t,e)}paste(t="all"){const{clipboard:e}=this;if(e.isClear())return;const{sIndexes:i,eIndexes:s}=this.selector;R.call(this),e.isCopy()?D.call(this,e.get(),[i,s],t):e.isCut()&&L.call(this,e.get(),[i,s]),this.change(this.d)}autofill(t,e,i){R.call(this),D.call(this,this.selector.getRange(),[t,e],i,!0),this.change(this.d)}clearClipboard(){this.clipboard.clear()}eachMerges(t){z.call(this,t)}canUnmerge(){const[[t,e],[i,s]]=this.selector.getRange(),l=this.getCell(t,e);if(l&&l.merge){const[h,o]=l.merge;if(t+h===i&&e+o===s)return!0}return!1}merge(){if(!this.isMultiple())return;const{sIndexes:t,eIndexes:e}=this.selector,[i,s]=t,[l,h]=e,o=l-i,n=h-s;if(o>0||n>0){R.call(this);const l=this.getCellOrNew(i,s);l.merge=[o,n],W.call(this,t,e),T.call(this,t,e),this.setCell(i,s,l,"all"),this.change(this.d)}}unmerge(){if(!this.canUnmerge())return;R.call(this);const{sIndexes:t,eIndexes:e}=this.selector;delete this.getCell(...t).merge,A.call(this,t,e),this.change(this.d)}deleteCell(t="all"){const{sIndexes:e,eIndexes:i}=this.selector;R.call(this),T.call(this,e,i,t),"all"!==t&&"format"!==t||A.call(this,e,i),this.change(this.d)}insertRow(t=1){R.call(this);const{cellmm:e,rowm:i}=this.d,[s]=this.selector.sIndexes,l={};Object.keys(e).forEach(i=>{let h=parseInt(i,10);h>=s&&(h+=t),l[h]=e[i]}),this.d.cellmm=l,i.len=this.rowLen()+t,H.call(this,"row",s,t),this.change(this.d)}deleteRow(){R.call(this);const{cellmm:t,rowm:e}=this.d,[[i],[s]]=this.selector.getRange(),l=s-i+1,h={};Object.keys(t).forEach(e=>{const o=parseInt(e,10);o<i?h[o]=t[o]:e>s&&(h[o-l]=t[o])}),this.d.cellmm=h,e.len=this.rowLen()-l,H.call(this,"row",i,-l),this.change(this.d)}insertColumn(t=1){R.call(this);const{cellmm:e,colm:i}=this.d,[,s]=this.selector.sIndexes;Object.keys(e).forEach(i=>{const l={};Object.keys(e[i]).forEach(h=>{let o=parseInt(h,10);o>=s&&(o+=t),l[o]=e[i][h]}),e[i]=l}),i.len=this.colLen()+t,H.call(this,"col",s,t),this.change(this.d)}deleteColumn(){R.call(this);const{cellmm:t,colm:e}=this.d,[[,i],[,s]]=this.selector.getRange(),l=s-i+1;Object.keys(t).forEach(e=>{const h={};Object.keys(t[e]).forEach(o=>{const n=parseInt(o,10);n<i?h[n]=t[e][o]:n>s&&(h[n-l]=t[e][o])}),t[e]=h}),e.len=this.colLen()-l,H.call(this,"col",i,-l),this.change(this.d)}scrollx(t,e){const{scroll:i}=this,[,s]=this.getFreeze(),[h,o,n]=l.rangeReduceIf(s,this.colLen(),0,0,t,t=>this.getColWidth(t));let r=o;t>0&&(r+=n),i.x!==r&&(i.indexes[1]=t>0?h-s:0,i.x=r,e())}scrolly(t,e){const{scroll:i}=this,[s]=this.getFreeze(),[h,o,n]=l.rangeReduceIf(s,this.rowLen(),0,0,t,t=>this.getRowHeight(t));let r=o;t>0&&(r+=n),i.y!==r&&(i.indexes[0]=t>0?h-s:0,i.y=r,e())}colTotalWidth(){return this.colSumWidth(0,this.colLen())}rowTotalHeight(){return this.rowSumHeight(0,this.rowLen())}cellRect(t,e){const{left:i,top:s}=this.cellPosition(t,e),l=this.getCell(t,e);let h=this.getColWidth(e),o=this.getRowHeight(t);if(null!==l&&l.merge){const[i,s]=l.merge;if(i>0)for(let e=1;e<=i;e+=1)o+=this.getRowHeight(t+e);if(s>0)for(let t=1;t<=s;t+=1)h+=this.getColWidth(e+t)}return{left:i,top:s,width:h,height:o,cell:l}}cellPosition(t,e){return{left:this.colSumWidth(0,e),top:this.rowSumHeight(0,t)}}getCellMerge(t,e){const i=this.getCell(t,e);return i&&i.merge?i.merge:[0,0]}getCell(t,e){const{cellmm:i}=this.d;return void 0!==i[t]&&void 0!==i[t][e]?i[t][e]:null}getCellStyle(t,e){const i=this.getCell(t,e),{styles:s}=this.d;return l.merge(this.options.style,i&&void 0!==i.si?s[i.si]:{})}setCellText(t,e,i){R.call(this),this.getCellOrNew(t,e).text=i,this.change(this.d)}setCell(t,e,i,s="all"){const{cellmm:l}=this.d;l[t]=l[t]||{},"all"===s?l[t][e]=i:"text"===s?(l[t][e]=l[t][e]||{},l[t][e].text=i.text):"format"===s&&(l[t][e]=l[t][e]||{},l[t][e].si=i.si,i.merge&&(l[t][e].merge=i.merge))}getCellOrNew(t,e){const{cellmm:i}=this.d;return i[t]=i[t]||{},i[t][e]=i[t][e]||{},i[t][e]}getFreeze(){return this.d.freeze}freezeIsActive(){const[t,e]=this.d.freeze;return t>0||e>0}setFreeze(t,e){R.call(this),this.d.freeze[0]=t,this.d.freeze[1]=e}freezeTotalWidth(){return this.colSumWidth(0,this.d.freeze[1])}freezeTotalHeight(){return this.rowSumHeight(0,this.d.freeze[0])}colSumWidth(t,e){return l.rangeSum(t,e,t=>this.getColWidth(t))}rowSumHeight(t,e){return l.rangeSum(t,e,t=>this.getRowHeight(t))}rowEach(t,e,i){let s=0;const{view:l}=this.options;for(let h=t;h<=e;h+=1){const t=this.getRowHeight(h);if(i(h,s,t),(s+=t)>l.height())break}}colEach(t,e,i){let s=0;const{view:l}=this.options;for(let h=t;h<=e;h+=1){const t=this.getColWidth(h);if(i(h,s,t),(s+=t)>l.width())break}}rowLen(){return this.d.rowm.len||this.options.row.len}colLen(){return this.d.colm.len||this.options.col.len}getColWidth(t){const{colm:e}=this.d,{col:i}=this.options;return e[`${t}`]?e[`${t}`].width:i.width}setColWidth(t,e){R.call(this);const{colm:i}=this.d;i[`${t}`]=i[`${t}`]||{},i[`${t}`].width=e,this.change(this.d)}getRowHeight(t){const{rowm:e}=this.d,{row:i}=this.options;return e[`${t}`]?e[`${t}`].height:i.height}setRowHeight(t,e){R.call(this);const{rowm:i}=this.d;i[`${t}`]=i[`${t}`]||{},i[`${t}`].height=e,this.change(this.d)}getFixedHeaderWidth(){return this.options.col.indexWidth}getFixedHeaderHeight(){return this.options.row.height}eachCells(t){const{cellmm:e}=this.d;Object.keys(e).forEach(i=>{Object.keys(e[i]).forEach(e=>{t(this.getCell(i,e),parseInt(i,10),parseInt(e,10))})})}eachMergesInView(t,e){(function(t,e){M(this.d.merges,t).forEach(([[t,i]])=>{e(t,i)})}).call(this,t,e)}eachCellsInView(t,e){(function(t,e){const[i,s,l,h]=t,o=M(this.d.merges,t);for(let t=i;t<=l;t+=1)for(let i=s;i<=h;i+=1){let[s,l]=[t,i];O(o,t,i,([[e,h],[,o]])=>{[s,l]=[e,h],e===t&&h===i||(i+=o-i)}),e(t,i,s,l)}}).call(this,t,e)}getViewRangeIndexes(t,e,i,s){return function(t,e,i,s){const{view:l}=this.options;let[h,o]=[0,0],[n,r]=[t,i];for(let i=t;i<e&&(n=i,!((o+=this.getRowHeight(i))>l.height()));i+=1);for(let t=i;t<s&&(r=t,!((h+=this.getColWidth(t))>l.width()));t+=1);return[t,i,n,r]}.call(this,t,e,i,s)}addStyle(t){const{styles:e}=this.d;for(let i=0;i<e.length;i+=1){const s=e[i];if(l.equals(s,t))return i}return e.push(t),e.length-1}getStyle(t){return this.d.styles[t]}}function P(t,e,i){t.addEventListener(e,i)}function B(t,e,i){t.removeEventListener(e,i)}function V(t,e,i){P(t,"mousemove",e),t.xEvtUp=(s=>{B(t,"mousemove",e),B(t,"mouseup",t.xEvtUp),i(s)}),P(t,"mouseup",t.xEvtUp)}function U(t,e,i,s){let l="";s(l=Math.abs(t)>Math.abs(e)?t>0?"right":"left":e>0?"down":"up",e,i)}const X="x-spreadsheet";window.devicePixelRatio;class Y{constructor(t=!1,e){this.moving=!1,this.vertical=t,this.el=o("div",`${X}-resizer ${t?"vertical":"horizontal"}`).children(this.hoverEl=o("div",`${X}-resizer-hover`).on("mousedown.stop",t=>this.mousedownHandler(t)),this.lineEl=o("div",`${X}-resizer-line`).hide()).hide(),this.cRect=null,this.finishedFn=null,this.minDistance=e}show(t,e){const{moving:i,vertical:s,hoverEl:l,lineEl:h,el:o}=this;if(i)return;this.cRect=t;const{left:n,top:r,width:c,height:a}=t;o.offset({left:s?n+c-5:n,top:s?r:r+a-5}).show(),l.offset({width:s?5:c,height:s?a:5}),h.offset({width:s?0:e.width,height:s?e.height:0})}hide(){this.el.offset({left:0,top:0}).hide()}mousedownHandler(t){let e=t;const{el:i,lineEl:s,cRect:l,vertical:h,minDistance:o}=this;let n=h?l.width:l.height;s.show(),V(window,t=>{this.moving=!0,null!==e&&1===t.buttons&&(h?(n+=t.movementX)>o&&i.css("left",`${l.left+n}px`):(n+=t.movementY)>o&&i.css("top",`${l.top+n}px`),e=t)},()=>{e=null,s.hide(),this.moving=!1,this.hide(),this.finishedFn&&(n<o&&(n=o),this.finishedFn(l,n))})}}class K{constructor(t){this.vertical=t,this.moveFn=null,this.el=o("div",`${X}-scrollbar ${t?"vertical":"horizontal"}`).child(this.contentEl=o("div","")).on("mousemove.stop",()=>{}).on("scroll.stop",t=>{const{scrollTop:e,scrollLeft:i}=t.target;this.moveFn&&this.moveFn(this.vertical?e:i,t)})}move(t){return this.el.scroll(t),this}scroll(){return this.el.scroll()}set(t,e){const i=t-1;if(e>i){const t=this.vertical?"height":"width";this.el.css(t,`${i}px`).show(),this.contentEl.css(this.vertical?"width":"height","1px").css(t,`${e}px`)}else this.el.hide();return this}}const _=3;let q=10;class J{constructor(){this.cornerEl=o("div",`${X}-selector-corner`),this.areaEl=o("div",`${X}-selector-area`).child(this.cornerEl).hide(),this.clipboardEl=o("div",`${X}-selector-clipboard`).hide(),this.autofillEl=o("div",`${X}-selector-autofill`).hide(),this.el=o("div",`${X}-selector`).css("z-index",`${q}`).children(this.areaEl,this.clipboardEl,this.autofillEl).hide(),q+=1}setOffset(t){return this.el.offset(t).show(),this}hide(){return this.el.hide(),this}setAreaOffset(t){const{left:e,top:i,width:s,height:l}=t;this.areaEl.offset({width:s-_+.8,height:l-_+.8,left:e-.8,top:i-.8}).show()}setClipboardOffset(t){const{left:e,top:i,width:s,height:l}=t;this.clipboardEl.offset({left:e,top:i,width:s-5,height:l-5})}showAutofill(t){const{left:e,top:i,width:s,height:l}=t;this.autofillEl.offset({width:s-_,height:l-_,left:e,top:i}).show()}hideAutofill(){this.autofillEl.hide()}showClipboard(){this.clipboardEl.show()}hideClipboard(){this.clipboardEl.hide()}}function Z(t){const{data:e}=this,{left:i,top:s,width:l,height:h,scroll:o,l:n,t:r}=t,c=e.freezeTotalWidth(),a=e.freezeTotalHeight();let d=i-c;c>n&&(d-=o.x);let f=s-a;return a>r&&(f-=o.y),{left:d,top:f,width:l,height:h}}function G(t){const{data:e}=this,{left:i,width:s,height:l,l:h,t:o,scroll:n}=t,r=e.freezeTotalWidth();let c=i-r;return r>h&&(c-=n.x),{left:c,top:o,width:s,height:l}}function Q(t){const{data:e}=this,{top:i,width:s,height:l,l:h,t:o,scroll:n}=t,r=e.freezeTotalHeight();let c=i-r;return r>o&&(c-=n.y),{left:h,top:c,width:s,height:l}}function tt(t){const{br:e}=this;e.setAreaOffset(Z.call(this,t))}function et(t){const{t:e}=this;e.setAreaOffset(G.call(this,t))}function it(t){const{l:e}=this;e.setAreaOffset(Q.call(this,t))}function st(t){const{l:e}=this;e.setClipboardOffset(Q.call(this,t))}function lt(t){const{br:e}=this;e.setClipboardOffset(Z.call(this,t))}function ht(t){const{t:e}=this;e.setClipboardOffset(G.call(this,t))}function ot(t){tt.call(this,t),function(t){const{tl:e}=this;e.setAreaOffset(t)}.call(this,t),et.call(this,t),it.call(this,t)}function nt(t){lt.call(this,t),function(t){const{tl:e}=this;e.setClipboardOffset(t)}.call(this,t),ht.call(this,t),st.call(this,t)}class rt{constructor(t){this.data=t,this.br=new J,this.t=new J,this.l=new J,this.tl=new J,this.br.el.show(),this.offset=null,this.areaOffset=null,this.indexes=null,this.sIndexes=null,this.eIndexes=null,this.saIndexes=null,this.eaIndexes=null,this.el=o("div",`${X}-selectors`).children(this.tl.el,this.t.el,this.l.el,this.br.el).hide(),q+=1}hide(){this.el.hide()}resetOffset(){const{data:t,tl:e,t:i,l:s,br:l}=this,h=t.freezeTotalHeight(),o=t.freezeTotalWidth();h>0||o>0?(e.setOffset({width:o,height:h}),i.setOffset({left:o,height:h}),s.setOffset({top:h,width:o}),l.setOffset({left:o,top:h})):(e.hide(),i.hide(),s.hide(),l.setOffset({left:0,top:0}))}resetAreaOffset(){const t=this.data.getSelectedRect(),e=this.data.getClipboardRect();ot.call(this,t),nt.call(this,e),this.resetOffset()}resetBRTAreaOffset(){const t=this.data.getSelectedRect(),e=this.data.getClipboardRect();tt.call(this,t),et.call(this,t),lt.call(this,e),ht.call(this,e),this.resetOffset()}resetBRLAreaOffset(){const t=this.data.getSelectedRect(),e=this.data.getClipboardRect();tt.call(this,t),it.call(this,t),lt.call(this,e),st.call(this,e),this.resetOffset()}set(t,e,i=!0){const{data:s}=this,[l,h]=s.calRangeIndexes(t,e);if(i){let[i,l]=[t,e];t<0&&(i=0),e<0&&(l=0),s.setSelectedCurrentIndexes([i,l]),this.indexes=[i,l]}this.moveIndexes=l,this.sIndexes=l,this.eIndexes=h,this.resetAreaOffset(),this.el.show()}setEnd(t,e){const{data:i}=this,[s,l]=i.calRangeIndexes2(t,e);this.sIndexes=s,this.eIndexes=l,this.reset()}reset(){ot.call(this,this.data.getSelectedRect())}showAutofill(t,e){if(-1===t&&-1===e)return;const[i,s]=this.sIndexes,[l,h]=this.eIndexes,[o,n]=[t,e],r=i-t,c=l-t,a=h-e;if(s-e>0)this.saIndexes=[i,n],this.eaIndexes=[l,s-1];else if(r>0)this.saIndexes=[o,s],this.eaIndexes=[i-1,h];else if(a<0)this.saIndexes=[i,h+1],this.eaIndexes=[l,n];else{if(!(c<0))return this.saIndexes=null,void(this.eaIndexes=null);this.saIndexes=[l+1,s],this.eaIndexes=[o,h]}if(null!==this.saIndexes){const t=this.data.getRect(this.saIndexes,this.eaIndexes);t.width+=2,t.height+=2;const{br:e,l:i,t:s,tl:l}=this;e.showAutofill(Z.call(this,t)),i.showAutofill(Q.call(this,t)),s.showAutofill(G.call(this,t)),l.showAutofill(t)}}hideAutofill(){["br","l","t","tl"].forEach(t=>{this[t].hideAutofill()})}showClipboard(){const t=this.data.getClipboardRect();nt.call(this,t),["br","l","t","tl"].forEach(t=>{this[t].showClipboard()})}hideClipboard(){["br","l","t","tl"].forEach(t=>{this[t].hideClipboard()})}}function ct(t){t.preventDefault();const{filterItems:e}=this;e.length<=0||(t.stopPropagation(),e[this.itemIndex].el.click(),this.hide())}class at{constructor(t,e){this.filterItems=[],this.items=t,this.el=o("div",`${X}-suggest`).hide(),this.itemClick=e,this.itemIndex=0}setOffset(t){this.el.cssRemoveKeys("top","bottom").offset(t)}hide(){this.filterItems=[],this.itemIndex=0,this.el.hide()}search(t){let{items:e}=this;/^\s*$/.test(t)||(e=e.filter(e=>e.key.startsWith(t.toUpperCase()))),e=e.map(t=>{const e=o("div",`${X}-item`).child(t.key).on("click.stop",()=>{this.itemClick(t),this.hide()});return e.child(o("div","label").html(t.title||t.label)),e}),this.filterItems=e,e.length<=0||(e[0].toggle(),this.el.html("").children(...e).show())}bindInputEvents(t){t.on("keydown",t=>(function(t){const{keyCode:e}=t;switch(t.ctrlKey&&t.stopPropagation(),e){case 37:t.stopPropagation();break;case 38:(function(t){t.preventDefault(),t.stopPropagation();const{filterItems:e}=this;e.length<=0||(e[this.itemIndex].toggle(),this.itemIndex-=1,this.itemIndex<0&&(this.itemIndex=e.length-1),e[this.itemIndex].toggle())}).call(this,t);break;case 39:t.stopPropagation();break;case 40:(function(t){t.stopPropagation();const{filterItems:e}=this;e.length<=0||(e[this.itemIndex].toggle(),this.itemIndex+=1,this.itemIndex>e.length-1&&(this.itemIndex=0),e[this.itemIndex].toggle())}).call(this,t);break;case 13:case 9:ct.call(this,t);break;default:t.stopPropagation()}}).call(this,t)),P(window,"click",t=>{this.el.contains(t.target)||this.hide()})}}function dt(){if(!/^\s*$/.test(this.inputText)){const{textlineEl:t,textEl:e,areaOffset:i}=this,s=t.offset().width+9,l=this.viewFn().width-i.left-9;if(s>i.width){let t=s;if(s>l){t=l;let h=parseInt(s/l,10);h+=s%l>0?1:0,(h*=this.rowHeight)>i.height&&e.css("height",`${h}px`)}e.css("width",`${t}px`)}}}function ft(t,e){const{textEl:i,textlineEl:s}=this;i.el.blur(),i.val(t),s.html(t),function(t){const{el:e}=this.textEl;setTimeout(()=>{e.focus(),e.setSelectionRange(t,t)},0)}.call(this,e)}class ut{constructor(t,e,i){this.viewFn=e,this.rowHeight=i,this.suggest=new at(t,t=>{(function(t){const{inputText:e}=this,i=e.lastIndexOf("="),s=e.substring(0,i+1);let l=e.substring(i+1);l=-1!==l.indexOf(")")?l.substring(l.indexOf(")")):"",this.inputText=`${s+t.key}(`;const h=this.inputText.length;this.inputText+=`)${l}`,ft.call(this,this.inputText,h)}).call(this,t)}),this.areaEl=o("div",`${X}-editor-area`).children(this.textEl=o("textarea","").on("input",t=>(function(t){const e=t.target.value;this.inputText=e;const i=e.lastIndexOf("="),{suggest:s,textlineEl:l}=this;-1!==i?s.search(e.substring(i+1)):s.hide(),l.html(e),dt.call(this)}).call(this,t)),this.textlineEl=o("div","textline"),this.suggest.el).on("mousemove.stop",()=>{}).on("mousedown.stop",()=>{}),this.el=o("div",`${X}-editor`).child(this.areaEl).hide(),this.suggest.bindInputEvents(this.textEl),this.areaOffset=null,this.freeze={w:0,h:0},this.cell=null,this.inputText="",this.change=(()=>{})}setFreezeLengths(t,e){this.freeze.w=t,this.freeze.h=e}clear(){const{cell:t}=this;(t&&t.text||"")!==this.inputText&&this.change(this.inputText),this.cell=null,this.areaOffset=null,this.inputText="",this.el.hide(),this.textEl.val(""),this.textlineEl.html("")}setOffset(t,e="top"){const{textEl:i,areaEl:s,suggest:l,freeze:h,el:o}=this;if(t){this.areaOffset=t;const{left:n,top:r,width:c,height:a,l:d,t:f}=t,u={left:0,top:0};h.w>d&&h.h>f||(h.w<d&&h.h<f?(u.left=h.w,u.top=h.h):h.w>d?u.top=h.h:h.h>f&&(u.left=h.w)),o.offset(u),s.offset({left:n-u.left-.8,top:r-u.top-.8}),i.offset({width:c-9+.8,height:a-3+.8});const g={left:0};g[e]=a,l.setOffset(g)}}setCell(t){this.el.show(),this.cell=t;const e=t&&t.text||"";this.inputText=e,ft.call(this,e,e.length),dt.call(this)}}const gt=[{key:"copy",title:"Copy",label:"Ctrl+C"},{key:"cut",title:"Cut",label:"Ctrl+X"},{key:"paste",title:"Paste",label:"Ctrl+V"},{key:"paste-value",title:"Paste values only",label:"Ctrl+Shift+V"},{key:"paste-format",title:"Paste format only",label:"Ctrl+Alt+V"},{key:"divider"},{key:"insert-row",title:"Insert row"},{key:"insert-column",title:"Insert column"},{key:"divider"},{key:"delete-row",title:"Delete row"},{key:"delete-column",title:"Delete column"},{key:"delete-cell-text",title:"Delete cell"}];function pt(){return gt.map(t=>(function(t){return"divider"===t.key?o("div",`${X}-item divider`):o("div",`${X}-item`).on("click",()=>{this.itemClick(t.key),this.hide()}).children(t.title,o("div","label").child(t.label||""))}).call(this,t))}class mt{constructor(t){this.el=o("div",`${X}-contextmenu`).children(...pt.call(this)).hide(),this.viewFn=t,this.itemClick=(()=>{}),P(window,"click",t=>{this.el.contains(t.target)||this.hide()})}hide(){this.el.hide()}setPosition(t,e){const{el:i}=this,{height:s,width:l}=i.show().offset(),h=this.viewFn();let o=e,n=t;h.height-e<=s&&(o-=s-1),h.width-t<=l&&(n-=l-1),i.offset({left:n,top:o})}}function bt(){return window.devicePixelRatio||1}function wt(){return bt()-.5}function xt(t){return parseInt(t*bt(),10)}class vt{constructor(t,e,i,s,l=0){this.x=t,this.y=e,this.width=i,this.height=s,this.padding=l,this.bgcolor="#ffffff",this.borderTop=null,this.borderRight=null,this.borderBottom=null,this.borderLeft=null}setBorders(t,e,i,s){t&&(this.borderTop=t),e&&(this.borderRight=e),i&&(this.borderBottom=i),s&&(this.borderLeft=s)}innerWidth(){return this.width-2*this.padding}innerHeight(){return this.height-2*this.padding}textx(t){const{width:e,padding:i}=this;let{x:s}=this;return"left"===t?s+=i:"center"===t?s+=e/2:"right"===t&&(s+=e-i),s}texty(t,e,i){const{height:s,padding:l}=this;let{y:h}=this;if("top"===t)h+=l;else if("middle"===t){const t=h+s/2-i,o=h+l+e/2+1;h=t<o?o:t}else"bottom"===t&&(h+=s-2*i-l);return h}topxys(){const{x:t,y:e,width:i}=this;return[[t,e],[t+i,e]]}rightxys(){const{x:t,y:e,width:i,height:s}=this;return[[t+i,e],[t+i,e+s]]}bottomxys(){const{x:t,y:e,width:i,height:s}=this;return[[t,e+s],[t+i,e+s]]}leftxys(){const{x:t,y:e,height:i}=this;return[[t,e],[t,e+i]]}}function yt(t,e,i,s,l,h,o){const n={x:0,y:0};"underline"===t?n.y="bottom"===l?0:"top"===l?-(h+2):-h/2:"strikethrough"===t&&("bottom"===l?n.y=h/2:"top"===l&&(n.y=-(h/2+2))),"center"===s?n.x=o/2:"right"===s&&(n.x=o),this.line([e-n.x,i-n.y],[e-n.x+o,i-n.y])}class kt{constructor(t,e,i){this.el=t,this.ctx=t.getContext("2d"),this.resize(e,i),this.ctx.scale(bt(),bt())}resize(t,e){this.el.style.width=`${t}px`,this.el.style.height=`${e}px`,this.el.width=xt(t),this.el.height=xt(e)}clear(){const{width:t,height:e}=this.el;return this.ctx.clearRect(0,0,t,e),this}attr(t){return Object.assign(this.ctx,t),this}save(){return this.ctx.save(),this.ctx.beginPath(),this}restore(){return this.ctx.restore(),this}beginPath(){return this.ctx.beginPath(),this}translate(t,e){return this.ctx.translate(xt(t),xt(e)),this}fillRect(t,e,i,s){return this.ctx.fillRect(xt(t)-.5,xt(e)-.5,xt(i),xt(s)),this}fillText(t,e,i){return this.ctx.fillText(t,xt(e),xt(i)),this}text(t,e,i={},s=!0){const{ctx:l}=this,{align:h,valign:o,font:n,color:r,strikethrough:c,underline:a}=i,d=e.textx(h);l.save(),this.attr({textAlign:h,textBaseline:o,font:`${n.italic?"italic":""} ${n.bold?"bold":""} ${xt(n.size)}px ${n.name}`,fillStyle:r,strokeStyle:r});const f=l.measureText(t).width;let u=0;if(s){u=(Math.ceil(f/e.innerWidth())-1)*n.size/2}let g=e.texty(o,n.size,u);if(s&&f>e.innerWidth()){const i={len:0,start:0};for(let s=0;s<t.length;s+=1)i.len>=e.innerWidth()&&(this.fillText(t.substring(i.start,s),d,g),c&&yt.call(this,"strikethrough",d,g,h,o,n.size,i.len),a&&yt.call(this,"underline",d,g,h,o,n.size,i.len),g+=n.size+2,i.len=0,i.start=s),i.len+=l.measureText(t[s]).width;s&&i.len>0&&(this.fillText(t.substring(i.start),d,g),c&&yt.call(this,"strikethrough",d,g,h,o,n.size,i.len),a&&yt.call(this,"underline",d,g,h,o,n.size,i.len))}else this.fillText(t,d,g),c&&yt.call(this,"strikethrough",d,g,h,o,n.size,f),a&&yt.call(this,"underline",d,g,h,o,n.size,f);return l.restore(),this}border(t,e){const{ctx:i}=this;return i.lineWidth=wt,i.strokeStyle=e,"medium"===t?i.lineWidth=xt(1)+.5:"thick"===t?i.lineWidth=xt(2):"dashed"===t?i.setLineDash([xt(3),xt(2)]):"dotted"===t?i.setLineDash([xt(1),xt(1)]):"double"===t&&i.setLineDash([xt(2),0]),this}line(...t){const{ctx:e}=this;if(t.length>1){const[i,s]=t[0];e.moveTo(xt(i)-.5,xt(s)-.5);for(let i=1;i<t.length;i+=1){const[s,l]=t[i];e.lineTo(xt(s)-.5,xt(l)-.5)}e.stroke()}return this}strokeBorders(t){const{ctx:e}=this;e.save(),e.beginPath();const{borderTop:i,borderRight:s,borderBottom:l,borderLeft:h}=t;i&&(this.border(...i),this.line(...t.topxys())),s&&(this.border(...s),this.line(...t.rightxys())),l&&(this.border(...l),this.line(...t.bottomxys())),h&&(this.border(...h),this.line(...t.leftxys())),e.restore()}rect(t){const{ctx:e}=this,{x:i,y:s,width:l,height:h,bgcolor:o}=t;e.save(),e.beginPath(),e.fillStyle=o||"#fff",e.strokeStyle="#e6e6e6",e.rect(xt(i)-.5,xt(s)-.5,xt(l),xt(h)),e.fill(),e.stroke(),this.strokeBorders(t),e.restore()}}const Ct=5,It={fillStyle:"#f4f5f8"};function Et(t,e){const{data:i}=this,{left:s,top:l,width:h,height:o}=i.cellRect(t,e);return new vt(s,l,h,o,Ct)}function $t(t,e){const{draw:i,data:s}=this,{cellmm:l}=s.d,h=s.getCell(t,e),o=s.getCellStyle(t,e),n=Et.call(this,t,e);if(n.bgcolor=o.bgcolor,i.rect(n),null!==h){let r=k.render(t,e,h.text||"",s.formulam,(t,e)=>l[e]&&l[e][t]&&l[e][t].text||"");h.format&&(r=s.formatm[h.format].render(r));const c=Object.assign({},o.font);c.size=function(t){for(let e=0;e<g.length;e+=1){const i=g[e];if(i.pt===t)return i.px}return t}(c.size),i.text(r,n,{align:o.align,valign:o.valign,font:c,color:o.color,strikethrough:o.strikethrough,underline:o.underline},o.textwrap)}}function St(t,e,i,s,l){const{draw:h,data:o}=this,{col:n,row:r}=o.options;h.save(),h.translate(n.indexWidth,r.height).translate(-l.x,-l.y);const c=o.getViewRangeIndexes(t,e,i,s);o.eachCellsInView(c,(t,e)=>$t.call(this,t,e)),o.eachMergesInView(c,(t,e)=>$t.call(this,t,e)),o.eachCellsInView(c,(t,e,i,s)=>{(function(t,e){const{draw:i,data:s}=this,l=s.getCell(t,e);if(l&&void 0!==l.si){const h=s.getStyle(l.si);if(h){const{bt:s,br:l,bb:o,bl:n}=h;if(void 0!==s||void 0!==l||void 0!==o||void 0!==n){const h=Et.call(this,t,e);h.setBorders(s,l,o,n),i.strokeBorders(h)}}}}).call(this,i,s)}),h.restore()}function Rt(t,e,i,s){const{draw:l}=this;l.save(),l.attr({fillStyle:"rgba(75, 137, 255, 0.08)"}).fillRect(t,e,i,s),l.restore()}function Tt(t,e,i,s){const{draw:l,data:h}=this,{col:o,row:n}=h.options;l.save();const r=h.rowSumHeight(0,e)+n.height,c=h.colSumWidth(0,s)+o.indexWidth;l.attr(It).fillRect(0,0,o.indexWidth,r).fillRect(0,0,c,n.height);const[[a,d],[f,u]]=h.selector.getRange();l.attr({textAlign:"center",textBaseline:"middle",font:`500 ${xt(12)}px Source Sans Pro`,fillStyle:"#585757",lineWidth:wt(),strokeStyle:"#e6e6e6"}),h.rowEach(t,e,(t,i,s)=>{const h=i+n.height;l.line([0,h],[o.indexWidth,h]),t!==e&&(a<=t&&t<f+1&&Rt.call(this,0,h,o.indexWidth,s),l.fillText(t+1,o.indexWidth/2,h+s/2))}),l.line([o.indexWidth,0],[o.indexWidth,r]),h.colEach(i,s,(t,e,i)=>{const h=e+o.indexWidth;l.line([h,0],[h,n.height]),t!==s&&(d<=t&&t<u+1&&Rt.call(this,h,0,i,n.height),l.fillText(b.stringAt(t),h+i/2,n.height/2))}),l.line([0,n.height],[c,n.height]),l.attr({fillStyle:"#f4f5f8"}).fillRect(0,0,o.indexWidth,n.height).line([o.indexWidth,0],[o.indexWidth,n.height]).line([0,n.height],[o.indexWidth,n.height]),l.restore()}function zt(t,e,i){const{draw:s,data:l}=this,{row:h,col:o}=l.options;s.save().translate(o.indexWidth,h.height).translate(-i.x,-i.y).attr({strokeStyle:"rgba(75, 137, 255, .6)"}),s.line(t,e),s.restore()}function Ot(t,e,i,s,l){St.call(this,t,e,i,s,l),Tt.call(this,t,e,i,s)}var At=class{constructor(t,e){this.el=t;const i=e.getView();this.draw=new kt(t,i.width(),i.height()),this.data=e}render(){const t=this.data.getView();this.draw.resize(t.width(),t.height()),this.clear();const{data:e}=this,{indexes:i}=e.scroll;Ot.call(this,i[0],e.rowLen(),i[1],e.colLen(),e.scroll);const[s,l]=e.getFreeze();(s>0||l>0)&&(function(){const{data:t}=this,[e,i]=t.getFreeze(),{scroll:s}=t,l=t.rowSumHeight(0,e),h=t.colTotalWidth();e>0&&St.call(this,0,e,0,t.colLen(),{x:s.x,y:0});const o=t.rowTotalHeight(),n=t.colSumWidth(0,i);i&&St.call(this,0,t.rowLen(),0,i,{x:0,y:s.y}),zt.call(this,[0,l],[h,l],{x:s.x,y:0}),zt.call(this,[n,0],[n,o],{x:0,y:s.y})}.call(this),Ot.call(this,0,s,0,l,{x:0,y:0}))}clear(){this.draw.clear()}};class Wt extends h{constructor(t,e,i,s,...l){super("div",`${X}-dropdown ${s}`),this.title=t,this.change=(()=>{}),"string"==typeof t?this.title=o("div",`${X}-dropdown-title`).child(t):i&&this.title.addClass("arrow-left"),this.contentEl=o("div",`${X}-dropdown-content`).children(...l).css("width",e).hide(),this.headerEl=o("div",`${X}-dropdown-header`),this.headerEl.on("click",()=>{"block"!==this.contentEl.css("display")?this.show():this.hide()}).children(this.title,i?o("div",`${X}-icon arrow-right`).child(o("div",`${X}-icon-img arrow-down`)):""),this.children(this.headerEl,this.contentEl),P(window,"click",t=>{this.el.contains(t.target)||this.hide()})}setTitle(t){this.title.html(t),this.hide()}show(){this.contentEl.show(),this.parent().active()}hide(){this.parent().active(!1),this.contentEl.hide()}}class Ft extends Wt{constructor(){const t=u.map(t=>o("div",`${X}-item`).on("click",()=>{this.setTitle(t.title),this.change(t)}).child(t.title));super(u[0].title,"160px",!0,"bottom-left",...t)}}class Ht extends Wt{constructor(){super("10","60px",!0,"bottom-left",...g.map(t=>o("div",`${X}-item`).on("click",()=>{this.setTitle(`${t.pt}`),this.change(t)}).child(`${t.pt}`)))}}class Dt extends Wt{constructor(){let t=d.slice(0);t.splice(2,0,{key:"divider"}),t.splice(7,0,{key:"divider"}),super("Normal","220px",!0,"bottom-left",...t=t.map(t=>{const e=o("div",`${X}-item`);return"divider"===t.key?e.addClass("divider"):(e.child(t.title).on("click",()=>{this.setTitle(t.title),this.change(t)}),t.label&&e.child(o("div","label").html(t.label))),e}))}setTitle(t){for(let e=0;e<d.length;e+=1)d[e].key===t&&this.title.html(d[e].title)}}class Lt extends h{constructor(t){super("div",`${X}-icon`),this.iconNameEl=o("div",`${X}-icon-img ${t}`),this.child(this.iconNameEl)}setName(t){this.iconNameEl.className(`${X}-icon-img ${t}`)}}class Nt extends Wt{constructor(){const t=n.map(t=>o("div",`${X}-item`).on("click",()=>{this.hide(),this.change(t)}).child(t.key));super(new Lt("formula"),"180px",!0,"bottom-left",...t)}}const Mt=["#ffffff","#000100","#e7e5e6","#445569","#5b9cd6","#ed7d31","#a5a5a5","#ffc001","#4371c6","#71ae47"],jt=[["#f2f2f2","#7f7f7f","#d0cecf","#d5dce4","#deeaf6","#fce5d5","#ededed","#fff2cd","#d9e2f3","#e3efd9"],["#d8d8d8","#595959","#afabac","#adb8ca","#bdd7ee","#f7ccac","#dbdbdb","#ffe59a","#b3c6e7","#c5e0b3"],["#bfbfbf","#3f3f3f","#756f6f","#8596b0","#9cc2e6","#f4b184","#c9c9c9","#fed964","#8eaada","#a7d08c"],["#a5a5a5","#262626","#3a3839","#333f4f","#2e75b5","#c45a10","#7b7b7b","#bf8e01","#2f5596","#538136"],["#7f7f7f","#0c0c0c","#171516","#222a35","#1f4e7a","#843c0a","#525252","#7e6000","#203864","#365624"]],Pt=["#c00000","#fe0000","#fdc101","#ffff01","#93d051","#00b04e","#01b0f1","#0170c1","#012060","#7030a0"];function Bt(t){return o("td","").child(o("div",`${X}-color-palette-cell`).on("click.stop",()=>this.change(t)).css("background-color",t))}class Vt{constructor(){this.el=o("div",`${X}-color-palette`),this.change=(()=>{});const t=o("table","").children(o("tbody","").children(o("tr",`${X}-theme-color-placeholders`).children(...Mt.map(t=>Bt.call(this,t))),...jt.map(t=>o("tr",`${X}-theme-colors`).children(...t.map(t=>Bt.call(this,t)))),o("tr",`${X}-standard-colors`).children(...Pt.map(t=>Bt.call(this,t)))));this.el.child(t)}}class Ut extends Wt{constructor(t,e){const i=new Lt(t).css("height","16px").css("border-bottom",`3px solid ${e}`),s=new Vt;s.change=(t=>{this.setTitle(t),this.change(t)}),super(i,"auto",!1,"bottom-left",s.el)}setTitle(t){this.title.css("border-color",t),this.hide()}}class Xt extends Wt{constructor(t,e){super(new Lt(`align-${e}`),"auto",!0,"bottom-left",...t.map(t=>(function(t){return o("div",`${X}-item`).child(new Lt(t))})(`align-${t}`).on("click",()=>{this.setTitle(t),this.change(t)})))}setTitle(t){this.title.setName(`align-${t}`),this.hide()}}const Yt=[["thin",'<svg xmlns="http://www.w3.org/2000/svg" width="50" height="1" style="user-select: none;"><line x1="0" y1="0.5" x2="50" y2="0.5" stroke-width="1" stroke="black" style="user-select: none;"></line></svg>'],["medium",'<svg xmlns="http://www.w3.org/2000/svg" width="50" height="2" style="user-select: none;"><line x1="0" y1="1.0" x2="50" y2="1.0" stroke-width="2" stroke="black" style="user-select: none;"></line></svg>'],["thick",'<svg xmlns="http://www.w3.org/2000/svg" width="50" height="3" style="user-select: none;"><line x1="0" y1="1.5" x2="50" y2="1.5" stroke-width="3" stroke="black" style="user-select: none;"></line></svg>'],["dashed",'<svg xmlns="http://www.w3.org/2000/svg" width="50" height="1" style="user-select: none;"><line x1="0" y1="0.5" x2="50" y2="0.5" stroke-width="1" stroke="black" stroke-dasharray="2" style="user-select: none;"></line></svg>'],["dotted",'<svg xmlns="http://www.w3.org/2000/svg" width="50" height="1" style="user-select: none;"><line x1="0" y1="0.5" x2="50" y2="0.5" stroke-width="1" stroke="black" stroke-dasharray="1" style="user-select: none;"></line></svg>']];class Kt extends Wt{constructor(t){const e=new Lt("line-type");let i=0;const s=Yt.map((e,l)=>o("div",`${X}-item state ${t===e[0]?"checked":""}`).on("click",()=>{s[i].toggle("checked"),s[l].toggle("checked"),i=l,this.hide(),this.change(e)}).child(o("div",`${X}-line-type`).html(e[1])));super(e,"auto",!1,"bottom-left",...s)}}function _t(...t){return o("table","").child(o("tbody","").children(...t))}function qt(t){return o("td","").child(o("div",`${X}-border-palette-cell`).child(new Lt(`border-${t}`)).on("click",()=>{this.mode=t;const{mode:e,style:i,color:s}=this;this.change({mode:e,style:i,color:s})}))}class Jt{constructor(){this.color="#000",this.style="thin",this.mode="all",this.change=(()=>{}),this.ddColor=new Ut("line-color",this.color),this.ddColor.change=(t=>{this.color=t}),this.ddType=new Kt(this.style),this.ddType.change=(([t])=>{this.style=t}),this.el=o("div",`${X}-border-palette`);const t=_t(o("tr","").children(o("td",`${X}-border-palette-left`).child(_t(o("tr","").children(...["all","inside","horizontal","vertical","outside"].map(t=>qt.call(this,t))),o("tr","").children(...["left","top","right","bottom","none"].map(t=>qt.call(this,t))))),o("td",`${X}-border-palette-right`).children(o("div",`${X}-toolbar-btn`).child(this.ddColor.el),o("div",`${X}-toolbar-btn`).child(this.ddType.el))));this.el.child(t)}}class Zt extends Wt{constructor(){const t=new Lt("border-all"),e=new Jt;e.change=(t=>{this.change(t),this.hide()}),super(t,"auto",!1,"bottom-left",e.el)}}function Gt(t){return o("div",`${X}-toolbar-btn`).on("mouseenter",e=>{!function(t,e){if(e.classList.contains("active"))return;const{left:i,top:s,width:l,height:h}=e.getBoundingClientRect(),n=o("div",`${X}-tooltip`).html(t).show();document.body.appendChild(n.el);const r=n.box();n.css("left",`${i+l/2-r.width/2}px`).css("top",`${s+h+2}px`),P(e,"mouseleave",()=>{document.body.contains(n.el)&&document.body.removeChild(n.el)}),P(e,"click",()=>{document.body.contains(n.el)&&document.body.removeChild(n.el)})}(t,e.target)}).attr("data-tooltip",t)}function Qt(){return o("div",`${X}-toolbar-divider`)}function te(t,e,i=(()=>{})){return Gt(t).child(function(t){return new Lt(t)}(e)).on("click",()=>i())}function ee(t){let e=t;const i=t.split("-");i.length>1&&i.forEach((t,i)=>{0===i?e=t:e+=t[0].toUpperCase()+t.substring(1)});const s=this[`${e}El`];s.toggle(),this.change(t,s.hasClass("active"))}class ie extends Wt{constructor(){const t=new Lt("ellipsis"),e=o("div",`${X}-toolbar-more`);super(t,"auto",!1,"bottom-right",e),this.moreBtns=e,this.contentEl.css("max-width","420px")}}function se(){const{el:t,btns:e,moreEl:i,ddMore:s,btnChildren:l}=this,{moreBtns:h,contentEl:o}=s,n=t.box();let r=160,c=12;const a=[],d=[];l.forEach(t=>{const e=t.box();if(r+=e.width,"More"===t.attr("data-tooltip")||r<n.width)a.push(t);else{const{marginLeft:i,marginRight:s}=t.computedStyle();c+=e.width+parseInt(i,10)+parseInt(s,10),d.push(t)}}),e.html("").children(...a),h.html("").children(...d),o.css("width",`${c}px`),d.length>0?i.show():i.hide()}class le{constructor(t){this.data=t,this.change=(()=>{});const{style:e}=t.options;this.ddFormat=new Dt,this.ddFont=new Ft,this.ddFormula=new Nt,this.ddFontSize=new Ht,this.ddTextColor=new Ut("text-color",e.color),this.ddFillColor=new Ut("fill-color",e.bgcolor),this.ddAlign=new Xt(["left","center","right"],e.align),this.ddVAlign=new Xt(["top","middle","bottom"],e.valign),this.ddBorder=new Zt,this.ddMore=new ie,this.btnChildren=[this.undoEl=te("Undo (Ctrl+Z)","undo",()=>this.change("undo")),this.redoEl=te("Redo (Ctrl+Y)","redo",()=>this.change("redo")),this.paintformatEl=te("Paint format","paintformat",()=>ee.call(this,"paintformat")),this.clearformatEl=te("Clear format","clearformat",()=>this.change("clearformat")),Qt(),Gt("Format").child(this.ddFormat.el),Qt(),Gt("Font").child(this.ddFont.el),Gt("Font size").child(this.ddFontSize.el),Qt(),this.fontBoldEl=te("Bold (Ctrl+B)","bold",()=>ee.call(this,"font-bold")),this.fontItalicEl=te("Italic (Ctrl+I)","italic",()=>ee.call(this,"font-italic")),this.underlineEl=te("Underline (Ctrl+U)","underline",()=>ee.call(this,"underline")),this.strikethroughEl=te("Strikethrough","strikethrough",()=>ee.call(this,"strikethrough")),Gt("Text color").child(this.ddTextColor.el),Qt(),Gt("Fill color").child(this.ddFillColor.el),Gt("Borders").child(this.ddBorder.el),this.mergeEl=te("Merge cells","merge",()=>ee.call(this,"merge")),Qt(),Gt("Horizontal align").child(this.ddAlign.el),Gt("Vertical align").child(this.ddVAlign.el),this.textwrapEl=te("Text wrapping","textwrap",()=>ee.call(this,"textwrap")),Qt(),this.freezeEl=te("Freeze cell","freeze",()=>ee.call(this,"freeze")),Gt("Functions").child(this.ddFormula.el),this.moreEl=Gt("More").child(this.ddMore.el).hide()],this.el=o("div",`${X}-toolbar`),this.btns=o("div",`${X}-toolbar-btns`).children(...this.btnChildren),this.el.child(this.btns),function(){this.ddFormat.change=(t=>this.change("format",t.key)),this.ddFont.change=(t=>this.change("font-name",t.key)),this.ddFormula.change=(t=>this.change("formula",t.key)),this.ddFontSize.change=(t=>this.change("font-size",t.pt)),this.ddTextColor.change=(t=>this.change("color",t)),this.ddFillColor.change=(t=>this.change("bgcolor",t)),this.ddAlign.change=(t=>this.change("align",t)),this.ddVAlign.change=(t=>this.change("valign",t)),this.ddBorder.change=(t=>this.change("border",t))}.call(this),this.reset(),setTimeout(()=>{se.call(this)},0),P(window,"resize",()=>{se.call(this)})}paintformatActive(){return this.paintformatEl.hasClass("active")}paintformatToggle(){this.paintformatEl.toggle()}trigger(t){ee.call(this,t)}reset(){const{data:t}=this,e=t.getSelectedCellStyle(),i=t.getSelectedCell();this.undoEl.disabled(!t.canUndo()),this.redoEl.disabled(!t.canRedo()),this.mergeEl.active(t.canUnmerge()).disabled(t.selector.seqe());const{font:s}=e;this.ddFont.setTitle(s.name),this.ddFontSize.setTitle(s.size),this.fontBoldEl.active(s.bold),this.fontItalicEl.active(s.italic),this.underlineEl.active(e.underline),this.strikethroughEl.active(e.strikethrough),this.ddTextColor.setTitle(e.color),this.ddFillColor.setTitle(e.bgcolor),this.ddAlign.setTitle(e.align),this.ddVAlign.setTitle(e.valign),this.textwrapEl.active(e.textwrap),this.freezeEl.active(t.freezeIsActive()),i&&i.format&&this.ddFormat.setTitle(i.format)}}function he(t,e,i,s=!0){if(-1===e&&-1===i)return;const{table:l,selector:h,toolbar:o}=this;t?h.setEnd(e,i):h.set(e,i,s),o.reset(),l.render()}function oe(t,e){const{selector:i,data:s}=this;let[l,h]=i.indexes;const[o,n]=i.eIndexes;t&&([l,h]=i.moveIndexes),"left"===e?h>0&&(h-=1):"right"===e?(n!==h&&(h=n),h<s.colLen()-1&&(h+=1)):"up"===e?l>0&&(l-=1):"down"===e?(o!==l&&(l=o),l<s.rowLen()-1&&(l+=1)):"row-first"===e?h=0:"row-last"===e?h=s.colLen()-1:"col-first"===e?l=0:"col-last"===e&&(l=s.rowLen()-1),t&&(i.moveIndexes=[l,h]),he.call(this,t,l,h),function(){const{data:t,verticalScrollbar:e,horizontalScrollbar:i}=this,{l:s,t:l,left:h,top:o,width:n,height:r}=t.getSelectedRect(),c=this.getTableOffset();if(Math.abs(h)+n>c.width)i.move({left:s+n-c.width});else{const e=t.freezeTotalWidth();h<e&&i.move({left:s-1-e})}if(Math.abs(o)+r>c.height)e.move({top:l+r-c.height-1});else{const i=t.freezeTotalHeight();o<i&&e.move({top:l-1-i})}}.call(this)}function ne(){const{data:t,verticalScrollbar:e}=this,{height:i}=this.getTableOffset();e.set(i,t.rowTotalHeight())}function re(){const{data:t,horizontalScrollbar:e}=this,{width:i}=this.getTableOffset();t&&e.set(i,t.colTotalWidth())}function ce(){const{tableEl:t,overlayerEl:e,overlayerCEl:i,table:s,toolbar:l,selector:h}=this,o=this.getTableOffset(),n=this.getRect();t.attr(n),e.offset(n),i.offset(o),ne.call(this),re.call(this),function(){const{selector:t,data:e,editor:i}=this,[s,l]=e.getFreeze();if(s>0||l>0){const t=e.freezeTotalWidth(),s=e.freezeTotalHeight();i.setFreezeLengths(t,s)}t.resetAreaOffset()}.call(this),s.render(),l.reset(),h.reset()}function ae(){const{data:t,selector:e}=this;t.clearClipboard(),e.hideClipboard()}function de(){const{data:t,selector:e}=this;t.copy(),e.showClipboard()}function fe(){const{data:t,selector:e}=this;t.cut(),e.showClipboard()}function ue(t){this.data.paste(t),ce.call(this)}function ge(t){const{selector:e,data:i,table:s}=this,l=t.target.className===`${X}-selector-corner`;let{ri:h,ci:o}=i.getCellRectByXY(t.offsetX,t.offsetY);t.shiftKey||(l?e.showAutofill(h,o):he.call(this,!1,h,o),V(window,t=>{({ri:h,ci:o}=i.getCellRectByXY(t.offsetX,t.offsetY)),l?e.showAutofill(h,o):1!==t.buttons||t.shiftKey||he.call(this,!0,h,o)},()=>{l&&(i.autofill(e.saIndexes,e.eaIndexes,"all"),s.render()),e.hideAutofill(),function(){const{toolbar:t}=this;t.paintformatActive()&&(ue.call(this,"format"),ae.call(this),t.paintformatToggle())}.call(this)})),l||1!==t.buttons||t.shiftKey&&he.call(this,!0,h,o)}function pe(){const{editor:t,data:e}=this,i=e.getSelectedRect(),s=this.getTableOffset();let l="top";i.top>s.height/2&&(l="bottom"),t.setOffset(i,l)}function me(){const{editor:t,data:e}=this;pe.call(this),t.setCell(e.getSelectedCell()),ae.call(this)}function be(t){const{data:e,table:i}=this;e.setSelectedCellText(t),i.render()}function we(t){const{data:e}=this;"insert-row"===t?e.insertRow():"delete-row"===t?e.deleteRow():"insert-column"===t?e.insertColumn():"delete-column"===t?e.deleteColumn():"delete-cell"===t?e.deleteCell():"delete-cell-format"===t?e.deleteCell("format"):"delete-cell-text"===t&&e.deleteCell("text"),ae.call(this),ce.call(this)}function xe(){const{overlayerEl:t,rowResizer:e,colResizer:i,verticalScrollbar:s,horizontalScrollbar:l,editor:h,contextMenu:o,data:n,toolbar:r}=this;t.on("mousemove",t=>{(function(t){if(0!==t.buttons)return;if(t.target.className===`${X}-resizer-hover`)return;const{offsetX:e,offsetY:i}=t,{rowResizer:s,colResizer:l,tableEl:h,data:o}=this;if(e>o.getFixedHeaderWidth()&&i>o.getFixedHeaderHeight())return s.hide(),void l.hide();const n=h.box(),r=o.getCellRectByXY(t.offsetX,t.offsetY);r.ri>=0&&-1===r.ci?(r.width=o.getFixedHeaderWidth(),s.show(r,{width:n.width})):s.hide(),-1===r.ri&&r.ci>=0?(r.height=o.getFixedHeaderHeight(),l.show(r,{height:n.height})):l.hide()}).call(this,t)}).on("mousedown",t=>{2===t.buttons?n.xyInSelectedRect(t.offsetX,t.offsetY)?o.setPosition(t.offsetX,t.offsetY):o.hide():2===t.detail?me.call(this):(h.clear(),ge.call(this,t))}).on("mousewheel.stop",t=>{(function(t){const{verticalScrollbar:e,data:i}=this,{top:s}=e.scroll();let l=t.deltaY;if(t.detail&&(l=40*t.detail),l>0){const t=i.scroll.indexes[0]+1;t<i.rowLen()&&e.move({top:s+i.getRowHeight(t)-1})}else{const t=i.scroll.indexes[0]-1;t>=0&&e.move({top:0===t?0:s-i.getRowHeight(t)})}}).call(this,t)}),function(t,{move:e,end:i}){let s=0,l=0;P(t,"touchstart",t=>{const{pageX:e,pageY:i}=t.touches[0];s=e,l=i}),P(t,"touchmove",t=>{if(!e)return;const{pageX:i,pageY:h}=t.changedTouches[0];U(i-s,h-l,t,e),s=i,l=h,t.preventDefault()}),P(t,"touchend",t=>{if(!i)return;const{pageX:e,pageY:h}=t.changedTouches[0];U(e-s,h-l,t,i)})}(t.el,{move:(t,e)=>{(function(t,e){const{verticalScrollbar:i,horizontalScrollbar:s}=this,{top:l}=i.scroll(),{left:h}=s.scroll();"left"===t||"right"===t?s.move({left:h-e}):"up"!==t&&"down"!==t||i.move({top:l-e})}).call(this,t,e)}}),r.change=((t,e)=>(function(t,e){const{data:i}=this;"undo"===t?this.undo():"redo"===t?this.redo():"print"===t||("paintformat"===t?!0===e?de.call(this):ae.call(this):"clearformat"===t?we.call(this,"delete-cell-format"):"link"===t||"chart"===t||"filter"===t||("freeze"===t?e?this.freeze(...i.selector.indexes):this.freeze(0,0):(i.setSelectedCellAttr(t,e),"formula"===t&&me.call(this),ce.call(this))))}).call(this,t,e)),e.finishedFn=((t,e)=>{(function(t,e){const{ri:i}=t,{table:s,selector:l,data:h}=this;h.setRowHeight(i,e),s.render(),l.resetAreaOffset(),ne.call(this),pe.call(this)}).call(this,t,e)}),i.finishedFn=((t,e)=>{(function(t,e){const{ci:i}=t,{table:s,selector:l,data:h}=this;h.setColWidth(i,e),s.render(),l.resetAreaOffset(),re.call(this),pe.call(this)}).call(this,t,e)}),s.moveFn=((t,e)=>{(function(t){const{data:e,table:i,selector:s}=this;e.scrolly(t,()=>{s.resetBRLAreaOffset(),pe.call(this),i.render()})}).call(this,t,e)}),l.moveFn=((t,e)=>{(function(t){const{data:e,table:i,selector:s}=this;e.scrollx(t,()=>{s.resetBRTAreaOffset(),pe.call(this),i.render()})}).call(this,t,e)}),h.change=(t=>{be.call(this,t),r.reset()}),o.itemClick=(t=>{"copy"===t?de.call(this):"cut"===t?fe.call(this):"paste"===t?ue.call(this,"all"):"paste-value"===t?ue.call(this,"text"):"paste-format"===t?ue.call(this,"format"):we.call(this,t)}),P(window,"resize",()=>{this.reload()}),P(window,"click",e=>{this.focusing=t.contains(e.target)}),P(window,"keydown",t=>{if(!this.focusing)return;const e=t.keyCode||t.which,{key:i,ctrlKey:s,shiftKey:l,altKey:c}=t;if(s){let i="all";switch(l&&(i="text"),c&&(i="format"),e){case 90:this.undo(),t.preventDefault();break;case 89:this.redo(),t.preventDefault();break;case 67:de.call(this),t.preventDefault();break;case 88:fe.call(this),t.preventDefault();break;case 85:r.trigger("underline"),t.preventDefault();break;case 86:ue.call(this,i),t.preventDefault();break;case 37:oe.call(this,l,"row-first"),t.preventDefault();break;case 38:oe.call(this,l,"col-first"),t.preventDefault();break;case 39:oe.call(this,l,"row-last"),t.preventDefault();break;case 40:oe.call(this,l,"col-last"),t.preventDefault();break;case 32:he.call(this,!1,-1,n.selector.indexes[1],!1),t.preventDefault();break;case 66:r.trigger("font-bold");break;case 73:r.trigger("font-italic")}}else{switch(e){case 32:l&&he.call(this,!1,n.selector.indexes[0],-1,!1);break;case 27:o.hide(),ae.call(this);break;case 37:oe.call(this,l,"left"),t.preventDefault();break;case 38:oe.call(this,l,"up"),t.preventDefault();break;case 39:oe.call(this,l,"right"),t.preventDefault();break;case 40:oe.call(this,l,"down"),t.preventDefault();break;case 9:h.clear(),oe.call(this,!1,l?"left":"right"),t.preventDefault();break;case 13:h.clear(),oe.call(this,!1,l?"up":"down"),t.preventDefault();break;case 8:we.call(this,"delete-cell-text"),t.preventDefault()}"Delete"===i?(we.call(this,"delete-cell-text"),t.preventDefault()):e>=65&&e<=90||e>=48&&e<=57||e>=96&&e<=105||"="===t.key?(be.call(this,t.key),me.call(this)):113===e&&me.call(this)}})}class ve{constructor(t,e){this.el=o("div",`${X}-sheet`),this.toolbar=new le(e),t.children(this.toolbar.el,this.el);const{row:i,col:s,view:l}=e.options;this.view=l,this.col=s,this.row=i,this.data=e,this.tableEl=o("canvas",`${X}-table`),this.rowResizer=new Y(!1,i.height),this.colResizer=new Y(!0,s.minWidth),this.verticalScrollbar=new K(!0),this.horizontalScrollbar=new K(!1),this.editor=new ut(Object.values(e.formulam),()=>this.getTableOffset(),i.height),this.contextMenu=new mt(()=>this.getTableOffset()),this.selector=new rt(e),this.overlayerCEl=o("div",`${X}-overlayer-content`).children(this.editor.el,this.selector.el),this.overlayerEl=o("div",`${X}-overlayer`).child(this.overlayerCEl),this.el.children(this.tableEl,this.overlayerEl.el,this.rowResizer.el,this.colResizer.el,this.verticalScrollbar.el,this.horizontalScrollbar.el,this.contextMenu.el),this.table=new At(this.tableEl.el,e),xe.call(this),ce.call(this),he.call(this,!1,0,0)}loadData(t){return this.data.load(t),ce.call(this),this}freeze(t,e){const{data:i}=this;return i.setFreeze(t,e),ce.call(this),this}undo(){this.data.undo(),ce.call(this)}redo(){this.data.redo(),ce.call(this)}reload(){return ce.call(this),this}getRect(){const t=this.view.height();return{width:this.view.width(),height:t}}getTableOffset(){const{row:t,col:e}=this,{width:i,height:s}=this.getRect();return{width:i-e.indexWidth,height:s-t.height,left:e.indexWidth,top:t.height}}}i(0);i.d(e,"spreadsheet",function(){return Ce});const ye={view:{height:()=>document.documentElement.clientHeight-41,width:()=>document.documentElement.clientWidth},formats:[],fonts:[],formula:[],row:{len:100,height:25},col:{len:26,width:100,indexWidth:60,minWidth:60},style:{bgcolor:"#ffffff",align:"left",valign:"middle",textwrap:!1,textDecoration:"normal",strikethrough:!1,underline:!1,color:"#0a0a0a",font:{name:"Helvetica",size:10,bold:!1,italic:!1}}};class ke{constructor(t,e={}){let i=t;"string"==typeof t&&(i=document.querySelector(t)),this.options=l.merge(ye,e),this.data=new j(this.options);const s=o("div",`${X}`).on("contextmenu",t=>t.preventDefault());i.appendChild(s.el),this.sheet=new ve(s,this.data)}loadData(t){return this.sheet.loadData(t),this}getData(){return this.data.d}change(t){return this.data.change=t,this}}const Ce=(t,e={})=>new ke(t,e);window&&(window.x=window.x||{},window.x.spreadsheet=Ce);e.default=ke}]);
//# sourceMappingURL=xspreadsheet.js.map